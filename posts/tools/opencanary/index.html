<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>OpenCanary</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />

<link rel="stylesheet" href="/application.ce62727cc9160bbe6a18a8fbd8b917264b67a058eb23f19f5b91641bb7ae50ae.css" integrity="sha256-zmJyfMkWC75qGKj72LkXJktnoFjrI/GfW5FkG7euUK4=" />





  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hu15095690576186281638.png" />

<meta property="og:url" content="https://nathanjmay.com:1313/posts/tools/opencanary/">
  <meta property="og:site_name" content="Nathan May">
  <meta property="og:title" content="OpenCanary">
  <meta property="og:description" content="Sample post with multiple images, embedded video etc.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-06-08T08:06:25+06:00">
    <meta property="article:modified_time" content="2020-06-08T08:06:25+06:00">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="OpenCanary">
  <meta name="twitter:description" content="Sample post with multiple images, embedded video etc.">

    
    
<meta name="description" content="Sample post with multiple images, embedded video etc." />


    

    




<script>
      theme = localStorage.getItem('theme-scheme') || localStorage.getItem('darkmode:color-scheme') || 'light';
      if (theme == 'system') {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        } else {
          theme = 'light';
        }
      }
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>

  <body class="type-posts kind-page" data-bs-spy="scroll" data-bs-target="#TableOfContents" data-bs-offset="80">
    <div class="container-fluid bg-secondary wrapper">
      
      
    















  


  




  
  
    
  
  



  
  
    
  
  







  




  




  


<nav class="navbar navbar-expand-xl top-navbar shadow " id="top-navbar">
  <div class="container">
    
    <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button">
      <i data-feather="sidebar"></i>
    </button>
    
    <a class="navbar-brand" href="/">
      
        <img src="/images/site/main-logo_hu15095690576186281638.png" id="logo" alt="Logo">
      Nathan May</a>
    <button
      class="navbar-toggler navbar-light"
      id="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#top-nav-items"
      aria-label="menu"
    >
      <i data-feather="menu"></i>
    </button>

    <div class="collapse navbar-collapse dynamic-navbar" id="top-nav-items">
      <ul class="nav navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/#home">Home</a>
        </li>
        
          
          
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#about">About</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#skills">Competitions/CTFs</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#experiences">Experiences</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#projects">Projects</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#recent-posts">Recent Posts</a>
                </li>
              
            
          
        
        
          <div id="top-navbar-divider"></div>
        
        
          <li class="nav-item">
            <a class="nav-link" id="blog-link" href="/posts">Posts</a>
          </li>
        
        
        
            
        
            
              <li class="nav-item">
                <a class="nav-link" href="https://nathanjmay.com"></a>
              </li>
            
        
        
        
      </ul>
    </div>
  </div>
  
  
    <img src="/images/site/main-logo_hu15095690576186281638.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/site/inverted-logo_hu9607983305513964252.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts/" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li>
      <i data-feather="plus-circle"></i><a class=" list-link" href="/posts/projects/"> Projects</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/projects/pfsensevpn/" title="Home VPN Setup with PFSense">Home VPN Setup with PFSense</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i data-feather="plus-circle"></i><a class=" list-link" href="/posts/resources/"> Resources</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/resources/fav/" title="My Favorite Resources">My Favorite Resources</a></li>
  

  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/resources/pentest/" title="PenTest&#43;">PenTest&#43;</a></li>
  


      </ul>
    </li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i data-feather="minus-circle"></i><a class="active list-link" href="/posts/tools/"> Tools</a>
      
      <ul class="active">
        
  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/tools/meterpreter/" title="Meterpreter">Meterpreter</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active list-link" href="/posts/tools/opencanary/" title="OpenCanary">OpenCanary</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/posts/tools/opencanary/images/canary.jpg);'>
      </div>

      
      <div class="page-content">
        
        <div class="author-profile ms-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/profile_hu800106212459491830.png' alt="Author Image">
          <h5 class="author-name">Nathan May</h5>
          <p class="text-muted">Monday, June 8, 2020 | 4 minutes</p>
        </div>
        
        
        <div class="title">
          <h1>OpenCanary</h1>
        </div>

        

        
          <div class="tags">
  <ul style="padding-left: 0;">
    
  </ul>
</div>

        
        <div class="post-content" id="post-content">
          <h3 id="what-is-opencanary">What is OpenCanary?</h3>
<p><a href="https://opencanary.readthedocs.io/en/latest/" target="_blank" rel="noopener">OpenCanary</a> is the free open source version of <a href="https://canary.tools/" target="_blank" rel="noopener">Canary</a>, a popular and advanced honeypot. OpenCanary takes a different approach to intrusion detection. Instead of monitoring network traffic for known malicious actions and signatures, OpenCanary is system meant to be attractive to attackers that will alert an administrator when an attack is detected.</p>
<h3 id="problems-with-typical-ids">Problems With Typical IDS</h3>
<p>If you have ever run an IDS like Snort, Suricata, Palo Alto, or similar, you know they flag a lot of traffic and make a lot of noise. Without fine-tuning the IDS properly, any legitimate warnings will be drowned in a mass of false positives and non-critical alerts. But even if the IDS administrator properly configures the system to decrease the alerts, there are still ways attackers can bypass an IDS. An attacker may use an unrecognizable zero day exploit, obfuscate their code, already be physically located inside with direct LAN access or leverage authentic means of remote access like a VPN to get access to a network without an IDS flagging the traffic.</p>
<h3 id="opencanarys-solution">OpenCanary’s Solution</h3>
<p>Thinking like an attacker, once they somehow manage to get a foothold into a network, they often attempt to pivot to other systems and gain as much control as possible. In many security breaches reviewed, the hackers had been active within the target’s network for weeks or longer laterally moving throughout the network. OpenCanary attempts to identify attackers that have managed to gain access by presenting itself as a target for the attacker. OpenCanary can host a variety of services like HTTP, SQL and FTP. When an attacker attempts to enumerate and exploit the OpenCanary services, notifications are sent to announce the intrusion attempt. Because of the level of interaction required to trigger an OpenCanary alert, false positives are extremely unlikely. Unless you happen to have an inquisitive tech savvy employee enumerating your network, alerts from the OpenCanary likely mean an attacker is actively within your network attempting to expand control.</p>
<h3 id="my-lab-setup">My Lab Setup</h3>
<p>To try out OpenCanary, I am using Ubuntu 20.10 as my OpenCanary system and Kali 2020.3 as my “attacker”. Both of these systems are deployed using VirtualBox and configured within the same NAT network so they will have LAN communication.</p>
<p><img alt="layout" src="/posts/tools/opencanary/images/lab.png"></p>
<h3 id="installation-steps">Installation Steps</h3>
<p>Update and install Python &amp; other dependencies</p>
<pre tabindex="0"><code>sudo apt update &amp;&amp; sudo apt upgrade &amp;&amp; sudo apt dist-upgrade

sudo apt install python3-dev python3-pip python3-virtualenv
sudo apt install build-essential libssl-dev libffi-dev libpcap0.8-dev
</code></pre><p>Create a directory for OpenCanary and create a python virtual environment</p>
<pre tabindex="0"><code>mkdir yourdirectory
cd yourdirectory
virtualenv env/
. env/bin/activate
</code></pre><p>Install Python packages</p>
<pre tabindex="0"><code>pip install opencanary
pip install scapy
pip install pcapy
pip install rdpy
</code></pre><p>Create the config file</p>
<pre tabindex="0"><code>opencanaryd --copyconfig
nano /etc/opencanardy/opencanary.conf
</code></pre><p>Here, you can select which services you want to enable by changing the entry to “true”.</p>
<p><img alt="layout" src="/posts/tools/opencanary/images/options.PNG"></p>
<p>I recommend logging be set up using syslog using this configuration:</p>
<pre tabindex="0"><code>            &#34;syslog-unix&#34;: {
                &#34;class&#34;: &#34;logging.handlers.SysLogHandler&#34;,
                &#34;formatter&#34;:&#34;syslog_rfc&#34;,
                &#34;address&#34;: [
                    &#34;localhost&#34;,
                    514
                ],
</code></pre><p>I will be using SMTP logging because I do not have a syslog server setup in this virtual environment:</p>
<pre tabindex="0"><code>        &#34;handlers&#34;: {
            &#34;SMTP&#34;: {
                &#34;class&#34;: &#34;logging.handlers.SMTPHandler&#34;,
                &#34;mailhost&#34;: [&#34;smtp.gmail.com&#34;, 587],
                &#34;fromaddr&#34;: &#34;noreply@yourdomain.com&#34;,
                &#34;toaddrs&#34; : [&#34;youraddress@gmail.com&#34;],
                &#34;subject&#34; : &#34;OpenCanary Alert&#34;,
                &#34;credentials&#34; : [&#34;youraddress&#34;, &#34;abcdefghijklmnop&#34;],
                &#34;secure&#34; : []
             }
         }
     }
 }
</code></pre><p>Once everything is configured as you want, use</p>
<pre tabindex="0"><code>opencanaryd --start
</code></pre><p>to start the service. You should soon receive an alert stating OpenCanary is running and a notification for each service started.</p>
<p><img alt="layout" src="/posts/tools/opencanary/images/email.PNG"></p>
<p>Simulating an attacker enumerating a device, I scanned the host and then tried to login to the discovered service:</p>
<p><img alt="layout" src="/posts/tools/opencanary/images/ftpfail.PNG"></p>
<p>As expected, I soon received an email notifying me of both the nmap scan and the failed login attempt:</p>
<p><img alt="layout" src="/posts/tools/opencanary/images/notify.PNG"> I then spent some time testing different enumeration/exploitation methods to see if OpenCanary would detect it and was impressed with the accuracy of alerts as well as the details within the alerts. Even if an attacker manages to take control of the OpenCanary device, OpenCanary will be able to send a few warning alerts before it is compromised.</p>
<h3 id="review">Review</h3>
<h4 id="things-i-like">Things I like</h4>
<ul>
<li>Lots of service options to choose from</li>
<li>Variety of logging options</li>
<li>Low false-positive rate</li>
<li>Free way to detect threats when they matter most</li>
</ul>
<h4 id="things-i-dont-like">Things I don’t like</h4>
<ul>
<li>You may need to create a new email to send alerts from</li>
<li>Email credentials stored in plain-text in configuration file</li>
<li>Setup is not super intuitive &amp; you may need to engineer your own way to automate startup</li>
</ul>
<h3 id="configuration-tips">Configuration Tips</h3>
<ul>
<li>Avoid the services that may be recognized as OpenCanary (for example, the HTTP DiskStation login may be a give away if the attacker is familiar with OpenCanary)</li>
<li>Avoid services with conflicting Operating System identifiers</li>
<li>Fewer services will generate fewer alerts, try sticking to one or two and always monitor the alerts</li>
<li>Enabling scan detection will likely generate too much traffic to be taken seriously (most scans will already generate logs because of the fingerprinting methods used)</li>
</ul>

        </div>

        
        <div class="row ps-3 pe-3">
        
          <div class="col-md-6 share-buttons">
          
            <strong>Share on:</strong>
            
            
                <a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fnathanjmay.com%3a1313%2fposts%2ftools%2fopencanary%2f&text=OpenCanary&via=Nathan%20May" target="_blank">
                  <i class="fab fa-twitter"></i>
                </a>
            
            
            
            
            
                <a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fnathanjmay.com%3a1313%2fposts%2ftools%2fopencanary%2f&title=OpenCanary" target="_blank">
                  <i class="fab fa-linkedin"></i>
                </a>
            
            
             
            
            
          
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/Term1N8/site-src.git/edit/main/content/posts/Tools/opencanary/index.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
    
    
  
  


<div class="row next-prev-navigator">
  
    <div class="col-md-6 previous-article">
      <a href="/posts/tools/meterpreter/" title="Meterpreter" class="btn filled-button">
        <div><i class="fas fa-chevron-circle-left"></i> Prev</div>
        <div class="next-prev-text">Meterpreter</div>
      </a>
    </div>
  
  
</div>

      <hr />

      
      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn" type="button" data-bs-toggle="tooltip" data-bs-placement="left" title="Scroll to top">
    <i class="fas fa-chevron-circle-up"></i>
  </a>
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center ps-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#what-is-opencanary">What is OpenCanary?</a></li>
        <li><a href="#problems-with-typical-ids">Problems With Typical IDS</a></li>
        <li><a href="#opencanarys-solution">OpenCanary’s Solution</a></li>
        <li><a href="#my-lab-setup">My Lab Setup</a></li>
        <li><a href="#installation-steps">Installation Steps</a></li>
        <li><a href="#review">Review</a>
          <ul>
            <li><a href="#things-i-like">Things I like</a></li>
            <li><a href="#things-i-dont-like">Things I don’t like</a></li>
          </ul>
        </li>
        <li><a href="#configuration-tips">Configuration Tips</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    












  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  
    
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-start">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#skills">Competitions/CTFs</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#projects">Projects</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#recent-posts">Recent Posts</a>
                </li>
              
            
              
                
              
                
              
            
          </ul>
          
        </div>
        
        
        
        
      </div>
    </div>
    
    
  </footer>


    <script src="/application.23fb896cbc5d363ef3a16968ca25c101ecb1d2c4468b93fcd96281102fc82cce.js" integrity="sha256-I/uJbLxdNj7zoWloyiXBAeyx0sRGi5P82WKBEC/ILM4=" defer></script>


    
     

    
    

</body>
</html>
