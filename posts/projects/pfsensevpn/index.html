<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Home VPN Setup with PFSense</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />

<link rel="stylesheet" href="/application.ce62727cc9160bbe6a18a8fbd8b917264b67a058eb23f19f5b91641bb7ae50ae.css" integrity="sha256-zmJyfMkWC75qGKj72LkXJktnoFjrI/GfW5FkG7euUK4=" />





  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hu15095690576186281638.png" />

<meta property="og:url" content="https://nathanjmay.com:1313/posts/projects/pfsensevpn/">
  <meta property="og:site_name" content="Nathan May">
  <meta property="og:title" content="Home VPN Setup with PFSense">
  <meta property="og:description" content="Sample post with multiple images, embedded video etc.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-06-08T08:06:25+06:00">
    <meta property="article:modified_time" content="2020-06-08T08:06:25+06:00">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Home VPN Setup with PFSense">
  <meta name="twitter:description" content="Sample post with multiple images, embedded video etc.">

    
    
<meta name="description" content="Sample post with multiple images, embedded video etc." />


    

    




<script>
      theme = localStorage.getItem('theme-scheme') || localStorage.getItem('darkmode:color-scheme') || 'light';
      if (theme == 'system') {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        } else {
          theme = 'light';
        }
      }
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>

  <body class="type-posts kind-page" data-bs-spy="scroll" data-bs-target="#TableOfContents" data-bs-offset="80">
    <div class="container-fluid bg-secondary wrapper">
      
      
    















  


  




  
  
    
  
  



  
  
    
  
  







  




  




  


<nav class="navbar navbar-expand-xl top-navbar shadow " id="top-navbar">
  <div class="container">
    
    <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button">
      <i data-feather="sidebar"></i>
    </button>
    
    <a class="navbar-brand" href="/">
      
        <img src="/images/site/main-logo_hu15095690576186281638.png" id="logo" alt="Logo">
      Nathan May</a>
    <button
      class="navbar-toggler navbar-light"
      id="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#top-nav-items"
      aria-label="menu"
    >
      <i data-feather="menu"></i>
    </button>

    <div class="collapse navbar-collapse dynamic-navbar" id="top-nav-items">
      <ul class="nav navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/#home">Home</a>
        </li>
        
          
          
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#about">About</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#skills">Competitions/CTFs</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#experiences">Experiences</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#projects">Projects</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="/#recent-posts">Recent Posts</a>
                </li>
              
            
          
        
        
          <div id="top-navbar-divider"></div>
        
        
          <li class="nav-item">
            <a class="nav-link" id="blog-link" href="/posts">Posts</a>
          </li>
        
        
        
            
        
            
              <li class="nav-item">
                <a class="nav-link" href="https://nathanjmay.com"></a>
              </li>
            
        
        
        
      </ul>
    </div>
  </div>
  
  
    <img src="/images/site/main-logo_hu15095690576186281638.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/site/inverted-logo_hu9607983305513964252.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts/" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
    
    
  
  
    
    <li>
      <i data-feather="minus-circle"></i><a class="active list-link" href="/posts/projects/"> Projects</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li><a class="active list-link" href="/posts/projects/pfsensevpn/" title="Home VPN Setup with PFSense">Home VPN Setup with PFSense</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i data-feather="plus-circle"></i><a class=" list-link" href="/posts/resources/"> Resources</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/resources/fav/" title="My Favorite Resources">My Favorite Resources</a></li>
  

  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/resources/pentest/" title="PenTest&#43;">PenTest&#43;</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i data-feather="plus-circle"></i><a class=" list-link" href="/posts/tools/"> Tools</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/tools/meterpreter/" title="Meterpreter">Meterpreter</a></li>
  

  
  
  
  
  
    
    <li><a class=" list-link" href="/posts/tools/opencanary/" title="OpenCanary">OpenCanary</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/posts/projects/pfsensevpn/images/vpn.jpg);'>
      </div>

      
      <div class="page-content">
        
        <div class="author-profile ms-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/profile_hu800106212459491830.png' alt="Author Image">
          <h5 class="author-name">Nathan May</h5>
          <p class="text-muted">Monday, June 8, 2020 | 6 minutes</p>
        </div>
        
        
        <div class="title">
          <h1>Home VPN Setup with PFSense</h1>
        </div>

        

        
          <div class="tags">
  <ul style="padding-left: 0;">
    
  </ul>
</div>

        
        <div class="post-content" id="post-content">
          <h3 id="introduction">Introduction</h3>
<p>Setting up PFSense as a VPS within your home environment will provide several benefits. First, all your home network traffic will be protected by a well developed and capable next generation firewall. <a href="https://www.pfsense.org/" target="_blank" rel="noopener">PFSense</a> has been around since 2006 and has continued to grow in support and development making it an extremely advanced open source security solution. Although I will not go into it within this post, PFSense has a package manager that can be used to install additional tools like Snort, Suricata, pfBlocker, Squid and more. Second, it will allow you to access your home network from anywhere in the world. This will allow you to reach any home file servers and remote control systems via RDP or SSH. Finally, you can configure the VPN to route all traffic through the PFSense firewall, so all your connections from across the world can be secured by your home firewall and any packages you have installed. All of this for no montly cost as everything in this guide is either open source or a free service.</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li>PFSense Firewall - I am using <a href="https://www.amazon.com/Firewall-Appliance-Gigabit-Celeron-AES-NI/dp/B07G9NHRGQ" target="_blank" rel="noopener">this</a> for my setup as AES-NI is recommended and the specs are adequate for my purposes</li>
<li>ISP that gives you a public IP address (static OR dynamic) and doesn’t mind you port forwarding</li>
<li>WiFi Access Point to give devices connectivity</li>
<li>Familiarity with networking and installing an operating system to a device</li>
</ul>
<h3 id="set-up-a-dynamic-dns-account">Set Up a Dynamic DNS Account</h3>
<p>This is only for those that do not pay for a static public IP address. If you are unsure, you likely have a dynamic address. I will be using <a href="https://freedns.afraid.org" target="_blank" rel="noopener">FreeDNS</a> as it is simple to configure for this purpose and free. After making your account, create a subdomain A record.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/freedns.png"></p>
<p>Then, go to Dynamic DNS in the menu. Copy the “Direct URL” for your A record. You will see something like <a href="https://freedns.afraid.org/dynamic/update.php?YOUR_CODE_HERE" target="_blank" rel="noopener">https://freedns.afraid.org/dynamic/update.php?YOUR_CODE_HERE</a>. Copy only your code and save it for later.</p>
<h3 id="installing-pfsense">Installing PFSense</h3>
<p>First thing you will need to do is install PFSense onto whatever Firewall you will be using. As this is pretty dependent on the Firewall you have chosen I will not go into great detail but use the downloads provided <a href="https://www.pfsense.org/download/" target="_blank" rel="noopener">here</a>. Once you have PFSense installed onto the Firewall, connect to the console port to access the PFSense CLI configuration menu.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/cli.jpg"></p>
<p>Go through the initial steps of assigning the interfaces for LAN and WAN (option 1), and setting up interface IP addresses (option 2). It is important to either assign yourself a static IP address in the WAN subnet, or setup a DHCP reservation on your modem. This will allow port forwarding to work properly. Once these are configured, you will be able to access the web GUI through the LAN IP address which will prompt you with a login as seen below.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/webgui.PNG"></p>
<p>Login with the default credentials (user:admin password:pfsense) to begin setting up the firewall.</p>
<h3 id="connect-your-dynamic-dns-server">Connect Your Dynamic DNS Server</h3>
<p>Within PFSense, go to Services -&gt; Dynamic DNS and select Add under Dynamic DNS Clients. If you are using a different Dynamic DNS provider than FreeDNS, look up how to add your dynamic DNS into PFSense. For freeDNS, select “freeDNS” as an option in the service type dropdown menu. Use WAN as the interface and type the full hostname into the hostname parameter. See below for an example:</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/dyndns.PNG"></p>
<p>Use the token from earlier steps creating the freeDNS account and enter it into the password and confirm password parameters. Then save and you should now see your hostname in the Dynamic DNS configuration page with your IP address in green showing it has been updated.</p>
<h3 id="create-your-vps">Create Your VPS</h3>
<p>To begin setup, go to VPN -&gt; OpenVPN -&gt; Wizards and go through the wizard creating a VPS for Local User Access. The wizard takes you through the main steps, configuring a Certificate Authority (CA), create a Server Certificate using that CA, then configure OpenVPN Server information. When configuring OpenVPN Server information, you will need to select a port/protocol, create a tunnel network, and specify the local network subnet. You may also need to modify the NCP algorithms to support connecting devices.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/wizard.PNG"></p>
<p>For example, you may want all VPN users to have an address 172.16.0.0/24 and allow them access to your home network at 10.0.1.0/24. Select “Redirect Gateway” if you want to force all traffic through the VPN, this will enforce any firewall/IPS protection to your remote devices. Additionally, you may want to enable Dynamic IP to help keep clients connected while they are on the move.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/wizard2.PNG"></p>
<p>In the last step, select both options to create firewall rules that allow your VPN to operate properly.</p>
<h3 id="create-users">Create Users</h3>
<p>To create users, go to System -&gt; User Manager and click add. Enter information for that user and select the Certificate checkbox. Use the VPN certificate authority to generate a client certificate. This will allow the user to connect to the VPN. Repeat to create all the users you would like to have access to the VPN.</p>
<h3 id="export-client-configurations">Export Client Configurations</h3>
<p>Go to System -&gt; Package Manager -&gt; Available Packages and install openvpn-client-export. When the install finishes, go to VPN -&gt; OpenVPN and you should see a new submenu labeled Client Export. Select the VPN configured previously for Remote Access Server, and the Dynamic DNS hostname. Additionally, you will want to check Use Random Local Port to ensure multiple clients can run at the same time. Save these settings so they will be used for all future client exports. ![]<img alt="layout" src="/posts/projects/pfsensevpn/images/client.PNG"></p>
<p>Scrolling to the bottom will show all the users configured for that VPN as well as options to export a config file for various platforms/operating systems. !<img alt="layout" src="/posts/projects/pfsensevpn/images/clientexport.PNG"></p>
<p>Download these configurations and send them to the people you want to connect, as well as their username and password configured earlier.</p>
<h3 id="port-forward">Port Forward</h3>
<p>To allow VPN traffic to the PFSense Firewall, port forwarding is required on the modem. By default, OpenVPN uses UDP 1194; however, some ISPs may restrict the ports you are actually allowed to forward. If this is the case, TCP 443 is usually allowed as it is the port HTTPS uses.</p>
<p>Go to your modem configuration page and setup port forwarding. Point the server IP to your PFSense WAN IP address and the TCP or UDP port chosen. Here is an example configuration on a Comcast modem.</p>
<p><img alt="layout" src="/posts/projects/pfsensevpn/images/portforward.PNG"></p>
<h3 id="connect-remotely">Connect Remotely</h3>
<p>Download the OpenVPN app on whatever device you use and import your configuration file. That’s it! You can now connect from anywhere in the world back to your home network. This setup can continue to be improved by taking advantage of other PFSense features like Snort, Squid, pfBlocker and others. I highly recommend you attempt to take full advantage of what PFSense has to offer by configuring strict firewall rules and utilizing the more advanced packages.</p>

        </div>

        
        <div class="row ps-3 pe-3">
        
          <div class="col-md-6 share-buttons">
          
            <strong>Share on:</strong>
            
            
                <a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fnathanjmay.com%3a1313%2fposts%2fprojects%2fpfsensevpn%2f&text=Home%20VPN%20Setup%20with%20PFSense&via=Nathan%20May" target="_blank">
                  <i class="fab fa-twitter"></i>
                </a>
            
            
            
            
            
                <a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fnathanjmay.com%3a1313%2fposts%2fprojects%2fpfsensevpn%2f&title=Home%20VPN%20Setup%20with%20PFSense" target="_blank">
                  <i class="fab fa-linkedin"></i>
                </a>
            
            
             
            
            
          
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/Term1N8/site-src.git/edit/main/content/posts/Projects/pfsensevpn/index.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
    
    
  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
  
      
      
      <div class="col-md-12 next-article">
        <a href="/posts/resources/fav/" title="My Favorite Resources" class="btn filled-button">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">My Favorite Resources</div>
        </a>
      </div>
    
</div>

      <hr />

      
      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn" type="button" data-bs-toggle="tooltip" data-bs-placement="left" title="Scroll to top">
    <i class="fas fa-chevron-circle-up"></i>
  </a>
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center ps-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#set-up-a-dynamic-dns-account">Set Up a Dynamic DNS Account</a></li>
        <li><a href="#installing-pfsense">Installing PFSense</a></li>
        <li><a href="#connect-your-dynamic-dns-server">Connect Your Dynamic DNS Server</a></li>
        <li><a href="#create-your-vps">Create Your VPS</a></li>
        <li><a href="#create-users">Create Users</a></li>
        <li><a href="#export-client-configurations">Export Client Configurations</a></li>
        <li><a href="#port-forward">Port Forward</a></li>
        <li><a href="#connect-remotely">Connect Remotely</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    












  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  
    
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-start">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#skills">Competitions/CTFs</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#projects">Projects</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://nathanjmay.com:1313/#recent-posts">Recent Posts</a>
                </li>
              
            
              
                
              
                
              
            
          </ul>
          
        </div>
        
        
        
        
      </div>
    </div>
    
    
  </footer>


    <script src="/application.23fb896cbc5d363ef3a16968ca25c101ecb1d2c4468b93fcd96281102fc82cce.js" integrity="sha256-I/uJbLxdNj7zoWloyiXBAeyx0sRGi5P82WKBEC/ILM4=" defer></script>


    
     

    
    

</body>
</html>
